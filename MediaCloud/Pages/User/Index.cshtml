@page
@model MediaCloud.WebApp.Pages.IndexModel
@{
    ViewData["Title"] = "Index page";
}

<div class="page-container mb-5" xmlns="http://www.w3.org/1999/html">
    <h1>
        Account settings
    </h1>

	<div class="button-panel">
        <div class="button-group">
           <a onclick="history.back();" class="btn btn-info">
	           ⮨ Back
			</a>
        </div>
	</div>

	<hr>
	<div class="w-100">
		<form enctype="multipart/form-data" method="post">
			<div class="row" style="max-width: 1000px;">
				<div asp-validation-summary="ModelOnly" class="text-danger"></div>

				@if (Model.User.IsAdmin)
				{
					<input type="hidden" asp-for=@(Model.IsEnvironmentSettingsChanged) class="form-control" id="IsEnvironmentSettingsChanged">
				}
				<input type="hidden" asp-for=@(Model.User.Id) class="form-control">

				<div>
					Name: @Html.DisplayTextFor(x => x.User.Name)
				</div>
				<div>
					Last login at: @Html.DisplayTextFor(x => x.User.LastLoginAt)
				</div>

				<div class="col-sm mt-4">
					<h5>UI appearance</h5>

					<div class="form-group mb-5">
						<label class="col-form-label">
							Theme
						</label>
						<select class="form-select" asp-for="@Model.UserSettings.UITheme">
							<option value="Light">Light</option>
							<option value="Dark">Dark</option>
						</select>
					</div>

					<h5>Gallery view</h5>
					
					<div class="form-group mb-5">
						<label class="col-form-label">
							Max columns count
						</label>
						<select class="form-select" asp-for="@Model.UserSettings.MaxColumnsCount">
							<option value="2">2</option>
							<option value="3">3</option>
							<option value="4">4</option>
							<option value="5">5</option>
							<option value="6">6</option>
						</select>
						<label class="col-form-label">
							Count of entities per page
						</label>
						<select class="form-select" asp-for="@Model.UserSettings.ListMaxEntitiesCount">
							<option value="12">12</option>
							<option value="24">24</option>
							<option value="36">36</option>
							<option value="48">48</option>
							<option value="64">64</option>
						</select>
						<label class="col-form-label">
							Count of showing pages in pagination
						</label>
						<select class="form-select" asp-for="@Model.UserSettings.ListMaxPageCount">
							<option value="4">4</option>
							<option value="6">6</option>
							<option value="8">8</option>
							<option value="10">10</option>
							<option value="12">12</option>
							<option value="16">16</option>
						</select>
						<label class="col-form-label" asp-for="@Model.UserSettings.ListAutoloadingEnabled">
							Autoload next entities in list
						</label>
						<div class="w-100">
							<input class="form-check-input big-form-check-input"
							       type="checkbox"
							       asp-for="@Model.UserSettings.ListAutoloadingEnabled"/>
						</div>
						<label class="col-form-label" asp-for="@Model.UserSettings.AllowedNSFWContent">
							Allowed NSFW content type to show
						</label>
						<select class="form-select" asp-for="@Model.UserSettings.AllowedNSFWContent">
							<option value="1">None</option>
							<option value="2">Sensitive</option>
							<option value="3">Questionable</option>
							<option value="4">Explicit</option>
						</select>
					</div>
				</div>
				<div class="col-sm mt-4 offset-sm-1">
					
					<h5>Statistics</h5>

					<div class="form-group mb-5">
						<label class="col-form-label">
							Count of days to show in activity statistic
						</label>
						<select class="form-select" asp-for="@Model.UserSettings.StatisticActivityBacktrackDayCount">
							<option value="7">7</option>
							<option value="14">14</option>
							<option value="30">30</option>
							<option value="60">60</option>
							<option value="90">90</option>
						</select>
						<label class="col-form-label">
							Count of top tags to use in statistics view
						</label>
						<select class="form-select" asp-for="@Model.UserSettings.StatisticTagsTopCount">
							<option value="15">15</option>
							<option value="30">30</option>
							<option value="50">50</option>
							<option value="100">100</option>
							<option value="200">200</option>
							<option value="300">300</option>
						</select>
					</div>

					@if (Model.User.IsAutotaggingAllowed)
					{
						<h5>AI autotagging</h5>

						<div class="form-group mb-5">
							<label class="col-form-label">
								Model
							</label>
							<select class="form-control" asp-for="@Model.UserSettings.AutotaggingAiModel">
								<option selected>Select model</option>
								@foreach (var aiModel in Model.AutotaggingAiModels)
								{
									<option value="@aiModel">@aiModel</option>
								}
							</select>
							<label class="col-form-label">
								Threshold confidence to tag accepting
							</label>
							<input class="form-control" asp-for="@Model.UserSettings.AutotaggingAiModelConfidence"/>
							<span asp-validation-for="@Model.UserSettings.AutotaggingAiModelConfidence"></span>
							<label class="col-form-label">
								Use MCut threshold (Strategy for Multi-Label classification)
							</label>
							<div class="w-100">
								<input class="form-check-input big-form-check-input"
								       type="checkbox"
								       asp-for="@Model.UserSettings.AutotaggingMCutThresholdEnabled"/>
							</div>
						</div>
					}
				</div>
				@if (Model.User.IsAdmin && Model.EnvironmentSettings != null)
				{
					<div class="col">
						<h4 class="pt-3">
							Environment settings:
						</h4>

						<hr class="mt-2 mb-4">

						<h5 class="mt-4">Autotagging</h5>

						<div class="form-group mb-3">
							<label class="col-form-label">
								Autotagging enabled.
							</label>
							<div class="w-100">
								<input class="form-check-input bg-warning big-form-check-input"
								       type="checkbox"
								       asp-for="@Model.EnvironmentSettings.AutotaggingEnabled"
								       onchange="environmentSettingsChanged()"/>
							</div>
							<label class="col-form-label">
								Autotagging Ai Model to use.
							</label>
							<select class="form-control bg-warning" asp-for="@Model.EnvironmentSettings.AutotaggingAiModel"
							        onchange="environmentSettingsChanged()">
								<option selected>Select model</option>
								@for (var i = 0; i < Model.AutotaggingAiModels.Count; i++)
								{
									<option value="@Model.AutotaggingAiModels[i]">@Model.AutotaggingAiModels[i]</option>
								}
							</select>
							<label class="col-form-label">
								Autotagging Ai Model confidence. Retrieve results only if model sure more than that threshold.
							</label>
							<input class="form-control bg-warning" asp-for="@Model.EnvironmentSettings.AutotaggingAiModelConfidence"
							       onchange="environmentSettingsChanged()"/>
						</div>

						<h5 class="mt-4">Common</h5>

						<div class="form-group mb-5">
							<label class="col-form-label">
								Max previews height size (pixels)
							</label>
							<input class="form-control bg-warning"
							       asp-for="@Model.EnvironmentSettings.PreviewMaxHeight"
							       onchange="environmentSettingsChanged()"/>
							<label class="col-form-label">
								Max file size (in Mb)
							</label>
							<input class="form-control bg-warning"
							       asp-for="@Model.EnvironmentSettings.MaxFileSize"
							       onchange="environmentSettingsChanged()"/>
						</div>


						<h5 class="mt-4">Security</h5>

						<div class="form-group mb-5">
							<label class="col-form-label">
								Cookie expiration time (min). Need an app restart to apply changes.
							</label>
							<input class="form-control bg-warning"
							       asp-for="@Model.EnvironmentSettings.CookieExpireTime"
							       onchange="environmentSettingsChanged()"/>
							<label class="col-form-label">
								Password min length
							</label>
							<input class="form-control bg-warning"
							       asp-for="@Model.EnvironmentSettings.PasswordMinLength"
							       onchange="environmentSettingsChanged()"/>
							<label class="col-form-label" asp-for="@Model.EnvironmentSettings.PasswordMustHaveSymbols">
								Password must have at least one symbol
							</label>
						</div>

						<input class="form-check-input bg-warning big-form-check-input"
						       type="checkbox"
						       asp-for="@Model.EnvironmentSettings.PasswordMustHaveSymbols"
						       onchange="environmentSettingsChanged()"/>
					</div>
				}
			</div>
			<input type="submit" value="💾 Save" class="btn btn-success" />
		</form>
	</div>
</div>

@if (Model.User.IsAdmin) {
	<script>
		function environmentSettingsChanged() {
			var element = document.getElementById("IsEnvironmentSettingsChanged");
			element.value = true;
		}
	</script>
}